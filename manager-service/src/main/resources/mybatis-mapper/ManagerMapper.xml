<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.managerservice.mapper.ManagerMapper">

    <resultMap type="com.example.managerservice.dto.Manager" id="managerInfo" >
        <result property="manager_uuid" column="managerUuid"/>
        <result property="manager_email" column="managerEmail"/>
        <result property="manager_password" column="managerPassword"/>
        <result property="manager_name" column="managerName"/>
        <result property="manager_phone_number" column="managerPhoneNum"/>
        <result property="manager_join_date" column="managerJoinDate"/>
        <result property="manager_nickname" column="managerNickname"/>
        <result property="manager_access_type" column="managerAccessType"/>
        <result property="manager_login_key" column="managerLoginKey"/>
        <result property="facility_no" column="facilityNo"/>
        <result property="facility_grade" column="facilityGrade"/>
    </resultMap>

    <!-- Manger 회원가입 -->
    <insert id="SignupManager" parameterType="com.example.managerservice.dto.Manager">
        insert  into manager values ( #{managerUuid},
                                     #{managerEmail},
                                     #{managerPassword},
                                     #{managerName},
                                     #{managerPhoneNum},
                                     #{managerNickname},
                                     #{managerProfileImage}
                                     );
    </insert>

    <!-- Manager 회원가입 - PhoneNumber 중복 검사 -->
    <select id="phoneNumberCheck" resultType="java.lang.Integer">
        select count(*)
        from manager
        where manager_phone_number = #{managerPhoneNum}
    </select>

    <!-- Manager 회원가입 - Email 중복 검사 -->
    <select id="emailConflictCheck" resultType="java.lang.Integer">
        select count(*)
        from manager
        where manager_email = #{managerEmail}
    </select>

    <!-- Manager 회원가입 - 닉네임 중복 체크 -->
    <select id="registerNicknameCheck" resultType="java.lang.Integer">
        select count(*)
        from manager
        where manager_nick_name = #{managerNickname}
    </select>

    <!-- Manager 로그인 - 매니저 찾기 (managerEmail) -->
    <select id="findManager" resultType="com.example.managerservice.dto.Manager">
        select *
        from manager
        where manager_email = #{managerEmail}
    </select>


    <!--Manager 아이디 찾기-->
    <select id="findManagerId" resultType="java.lang.String">
        select manager_email
        from manager
        where manager_phone_number = #{managerPhoneNumber} AND manager_name = #{managerName}
    </select>

    <!-- 비밀번호 찾기 - 초기화 된 비밀번호 저강-->
    <update id="changeManagerPW">
        update manager
        set manager_password = #{resetPassword}
        where manager_email = #{managerEmail}
    </update>

    <!--Manager 마이페이지 - 비빌번호 재설정-->
    <update id="changeManagerPW">
        update manager
        set manager_password = #{resetPassword}
        where manager_uuid = #{managerUuid}
    </update>

    <!--Manager 마이페이지 - uuid를통해 유저 정보 수정-->
    <select id="findManagerUuid" resultType="com.example.managerservice.dto.Manager">
        select *
        from manager
        where manager_uuid = #{managerUuid}
    </select>


    <!-- Manager 검증 -->
    <select id="getValidManager" resultType="java.lang.Integer">
        select count(*)
        from  manager
        where manager_id = #{managerId}
    </select>
</mapper>