<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.managerservice.mapper.FacilityContentMapper">

    <resultMap type="com.example.managerservice.dto.FacilityContentDto" id="facilityContentInfo" >
        <result property="facility_content_num" column="facilityContentNum"/>
        <result property="facility_content_title" column="facilityContentTitle"/>
        <result property="facility_content_text" column="facilityContentText"/>
        <result property="facility_content_img" column="facilityContentImg"/>
        <result property="facility_content_date" column="facilityContentDate"/>
        <result property="facility_content_look" column="facilityContentLook"/>
        <result property="facility_content_type" column="facilityContentType"/>
        <result property="facility_no" column="facilityNo"/>
        <result property="user_uuid" column="userUuid"/>
    </resultMap>

    <resultMap type="com.example.managerservice.dto.FacilityContentLikeDto" id="contentLikeInfo" >
        <result property="user_uuid" column="userUuid"/>
        <result property="content_num" column="contentNum"/>
    </resultMap>

    <insert id="registerContent" parameterType="com.example.managerservice.dto.FacilityContentDto">
        INSERT INTO facility_content (
            facility_content_num,
            facility_content_title,
            facility_content_text,
            facility_content_img,
            facility_content_date,
            facility_content_look,
            facility_content_type,
            facility_no,
            user_uuid
        )
        values (
                #{facilityContentNum},
                #{facilityContentTitle},
                #{facilityContentText},
                #{facilityContentImg},
                #{facilityContentDate},
                #{facilityContentLook},
                #{facilityContentType},
                #{facilityNo},
                #{userUuid}

               )
    </insert>

    <delete id="deleteContent" parameterType="com.example.managerservice.dto.FacilityContentDto">
        DELETE FROM facility_content
        WHERE facility_content_num = #{facilityContentNum}
          AND user_uuid = #{userUuid}
    </delete>

    <select id="contentDetailView" resultMap="facilityContentInfo">
        SELECT *
        FROM facility_content
        WHERE facility_content_num = #{facilityContentNum}
    </select>

    <select id="findValidFacilityContentNum" resultType="java.lang.Integer">
        SELECT count(*)
        FROM facility_content
        WHERE facility_content_num = #{facilityContentNum}
    </select>

    <select id="facilityInUserValid"  resultMap="facilityContentInfo">
        select *
        from facility_content
        where facility_content_num = #{facilityContentNum} AND user_uuid = #{userUuid}
    </select>


    <!-- 게시물 좋아요 -->
    <insert id="facilityContentLike" parameterType="com.example.managerservice.dto.FacilityContentLikeDto">
        INSERT INTO user_like_content (
            user_uuid,
            content_num
        )
        values (
                   #{userUuid},
                   #{contentNum}
               )
    </insert>

    <select id="getLikeCount"  resultType="java.lang.Integer">
        select count(*)
        from user_like_content
        where content_num = #{contentNum}
    </select>

    <select id="contentLikeBool"  resultType="java.lang.Integer">
        select if(count(*) >= 1, 1, 0)
        from user_like_content
        where content_num = #{contentNum} AND user_uuid = #{userUuid}
    </select>

    <delete id="deleteContentLike" parameterType="com.example.managerservice.dto.FacilityContentLikeDto">
        delete from user_like_content
        where content_num = #{contentNum}
          AND user_uuid = #{userUuid}
    </delete>

    <!-- 메인 페이지에 보일 게시물 -->
    <select id="getMyFacilityNoticeLt" resultMap="facilityContentInfo">
        <![CDATA[
        SELECT *
        FROM facility_content
        WHERE facility_content_type = 1 AND facility_no = #{facilityNo}
        ORDER BY facility_content_date DESC LIMIT ${count}
        ;
        ]]>
    </select>

    <select id="getMyFacilityLt" resultMap="facilityContentInfo">
        <![CDATA[
        SELECT *
        FROM facility_content
        WHERE facility_content_type = 0 AND facility_no = #{facilityNo}
        ORDER BY facility_content_date DESC LIMIT ${count}
        ;
        ]]>
    </select>

</mapper>